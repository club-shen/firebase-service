// Generated by CoffeeScript 1.10.0
(function() {
  var import_csv;

  import_csv = function(slug, file) {
    return fs.readFile(file, "utf8", function(err, data) {
      var games, i, j, k, len, match, match_array, match_string, match_strings, players, ref, ref1, ref2, ref3, ref4, ref5, ref6, ref7, results, set, time;
      if (err) {
        throw err;
      }
      match_strings = data.split("\n");
      results = [];
      for (i in match_strings) {
        match_string = match_strings[i];
        if (+i === 0) {
          continue;
        }
        match_array = match_string.split(",");
        time = (ref = match_array[1]) != null ? ref : false;
        set = match_array[2] != null ? +match_array[2] : 3;
        players = [match_array[4], match_array[5]];
        games = [];
        ref1 = [9, 13, 17, 21, 25];
        for (k = 0, len = ref1.length; k < len; k++) {
          j = ref1[k];
          if (match_array[j] === 'Defender' || match_array[j] === 'Challenger') {
            games.push({
              reports: [
                {
                  characters: [(ref2 = match_array[j - 3]) != null ? ref2 : "", (ref3 = match_array[j - 2]) != null ? ref3 : ""],
                  stage: (ref4 = match_array[j - 1]) != null ? ref4 : "",
                  winner: +(match_array[j] === 'Defender')
                }, {
                  characters: [(ref5 = match_array[j - 3]) != null ? ref5 : "", (ref6 = match_array[j - 2]) != null ? ref6 : ""],
                  stage: (ref7 = match_array[j - 1]) != null ? ref7 : "",
                  winner: +(match_array[j] === 'Defender')
                }
              ]
            });
          }
        }
        console.log("i = " + i + "\nplayers: " + players + "\nset: " + set + "\ntime: " + time);
        results.push(db.ref("ladders/" + slug + "/matches").push(match = {
          games: games,
          players: players,
          set: set,
          time: time
        }));
      }
      return results;
    });
  };

  import_csv("smash-4", "spreadsheet.csv");

}).call(this);
